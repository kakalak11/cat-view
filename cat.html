<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Viewer</title>

    <style>
        body {
            box-sizing: content-box;
            align-content: center;
            text-align: center;
            max-width: 80vw;
            margin: auto;
        }

        header {
            height: 15vh;
            margin: 10px;
        }

        .display {
            height: 70vh;
        }

        .display>img {
            height: 100%;
            object-fit: contain;
        }

        footer {
            margin: 20px auto 20px auto;
        }

        .navigation>button {
            margin-left: 20px;
            margin-right: 20px;
        }
    </style>
</head>

<body id='app'>
    <header>
        <h1>View cat for peace of mind</h1>
        <p>This is a front-end for cat API</p>
        <div>Try yours here &#128073; <a href="https://thecatapi.com/">https://thecatapi.com/</a></div>
    </header>

    <div class="display">
        <img id="cat-image" alt="A cat">
    </div>

    <footer class="navigation">
        <button onclick="prevImage()">
            Prev Cat
        </button>
        <button onclick="randomImageCache()">
            Random Cache
        </button>
        <button onclick="fetchNewImage()">
            New Cat
        </button>
        <button onclick="nextImage()">
            Next Cat
        </button>
    </footer>
</body>

<script>
    const API_KEY = "live_xZjBI0DsGYFT7iYVbmdmtoT8AIW0xd2AWLQYXW9Ua0dDqMYA5Ucue761hsXWdVIT";
    const headers = { 'x-api-key': API_KEY };
    const baseUrl = "https://api.thecatapi.com/v1";
    let fetchData = [];
    let currentPage = 0;
    const imgDiv = document.getElementById('cat-image');

    // imgDiv.src = "https://cdn2.thecatapi.com/images/8pCFG7gCV.jpg";

    fetch(`${baseUrl}/images/search?limit=10&breed_ids=beng`, headers)
        .then((response) => response.json())
        .then(data => {
            fetchData = fetchData.concat(data);

            randomImageCache();
        });

    function randomImageCache() {
        if (fetchData) {
            const randIndex = Math.floor(Math.random() * fetchData.length);

            if (fetchData[randIndex] && fetchData[randIndex].url) {
                imgDiv.src = fetchData[randIndex].url;
                currentPage = randIndex;
            }
        }
    }

    function fetchNewImage() {
        fetch(`${baseUrl}/images/search`, headers)
            .then((response) => response.json())
            .then(data => {
                data = data.pop();
                if (data && data.url) {
                    imgDiv.src = data.url;
                    fetchData = fetchData.concat(data);
                }
            })
            .catch(err => {
                throw new Error(err)
            });
    }

    function nextImage() {
        currentPage++
        if (currentPage >= fetchData.length) {
            currentPage = 0;
        }

        if (fetchData[currentPage] && fetchData[currentPage].url) {
            imgDiv.src = fetchData[currentPage].url;
        }
    }

    function prevImage() {
        currentPage--;
        if (currentPage < 0) {
            currentPage = fetchData.length - 1;
        }

        if (fetchData[currentPage] && fetchData[currentPage].url) {
            imgDiv.src = fetchData[currentPage].url;
        }
    }

</script>

</html>